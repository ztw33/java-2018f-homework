# 大作业介绍
## 关于程序

+ 运行效果
![Image](https://raw.githubusercontent.com/WitAnn/java-2018f-homework/master/Final%20Project/%E5%8D%95%E6%98%8E%E6%85%A7-161220029/img/image3.png)

+ 使用说明
    + 在战斗开始前，使用A切换妖怪方阵型。
    + 战斗过程中，可以使用R重新开始。（不推荐）
    + 在战斗结束后，使用R重新开始。
    + 在战斗开始前，或者R之后，使用L加载文件，后缀名为.huluwa
    + SPACE开始战斗
    + 战斗过程中自动保存存档为161220029.huluwa
    + 存档为追加模式，如果不想被覆盖，就将存档名改了或者删除。
+ 游戏介绍
    + 葫芦娃与妖怪之间进行了战斗。
    + 葫芦娃之间根据自己的特性，各显神通
        + 老大、老七攻击范围广，但是防御力较低。
        + 老二、老三、老六处于均衡水平。
        + 老四、老五分别控制水与火，子弹也和别的兄弟不同，分别是火球和水球。他们的攻击力要高出别的兄弟，但是防御力与攻击范围较小。
        + 老爷爷属于远程攻击，攻击范围极大，但是攻击力很低，血也很薄。
    + 道高一尺，魔高一丈，妖怪们也不甘示弱。
        + 蝎子精皮糙肉厚，攻击、防御都比较高，攻击方式为扔蝎子，攻击范围也属于较高水平，boss型人物。
        + 蛇精与老爷爷一样，远程攻击，范围极大，但是攻击力很低。
        + 小喽啰各项水平都比较低，但是胜在人多，当排出偃月阵或是锋矢阵的时候，可以数量碾压葫芦兄弟。
    + 死亡之后，会在原地留下草，后人会踩着前人的尸体继续战斗。

## 关于实现
+ Main类是一切函数的入口，它继承了Application类，用来运行javaFX程序。
    + 重载了其start方法，用来初始化一些画图工具，便于显示图片与血条。
    + 有一个内部类AnimationTimer，用来刷新战斗场景，生物体大概1s刷新一次，而子弹轨迹0.1s刷新一次，故刷新速度设为10帧。
    + 还有一个键盘监听的内部类，可以实现对于用户键盘输入的反应。
+ Game类是控制整个游戏流程的类，其中包含了人物、战场、子弹的初始化，并且实现了存档、读档。
    + 由于是100ms刷新一次，所以每次刷新的时候把当前战场的情况保存下来即可，当前战场情况包括：
        + 人物的血量、位置。
        + 子弹的数量、位置。
        + 如果死亡了，就不再记录。
    + 读档的时候，100ms读取一次，根据存档里面的情况，重绘当前战场即可。
+ 生物类以及其子类
    + 生物类是所有人物的基础，包含一些基本的方法和属性。
    + 生物类的子类里面全部实现了Runable接口，等到开始战斗的时候，就全部作为一个线程执行。抢占线程，进行移动和攻击。由于并行的不确定性，即使是同一个阵型，结果可能也会有所不同。
    + 生物类的重要方法，包括寻路与改变位置。寻路是根据敌人位置来的，这里面涉及到并发的东西，下面仔细说。
+ 编阵类
    + 葫芦娃的阵型只有长蛇阵，formForGood方法会对他们进行位置上的设置。
    + 妖怪的阵型可以改变，formForBad传入参数会根据阵型自动对小喽啰数量进行设置，并且将整个阵型摆好。
+ 战场类
    + 战场由砖块类组成，尺寸为15 x 15。
    + 一个砖块上面能且仅能站一个生物体，需要并发进行判断。
+ 子弹类
    + 不同的生物体有不同的子弹。
    + 需要根据生物体对于子弹进行加载与设置。
    + 需要根据攻击者与被攻击者的方位差异来进行速度计算，并在每次render的时候改变位置。
            
## 关于细节
+ 多线程
    + 每个生物在运行的时候都会成为一个线程，他们共享战场与敌人情况。但是由于不能同时站到一个砖块上也不能同时杀死一个敌人，就需要同步。代码中生物体对于生物体情况的获得以及战场情况的获得进行了同步，实现见下：
    >creatureLock.lock();
    > ...
    >synchronized(bt) 
    + 分别出现在攻击与寻路的方法里。

+ 注解
    + 在代码中有相当部分的注解，对于代码的可读性有了较大提高。
    
+ 测试
    + 对于战场情况的正确性进行了测试。
    + 对于人物初始化的正确性进行了测试。
    + 对于一些行动逻辑进行了测试。
+ 设计原则
    + OCP：所有的生物都继承了生物类，它们可以根据自身的情况进行拓展，而不是修改父类的代码。
    + LSP: 各种生物都继承了Creature类，满足is-A关系。
+ I/O操作
    + 在进行存档和读档的时候有大量的I/O操作，举例如：
    > w.write(tmp + " " + sevenBro.sevenBro[i].getHp() + " " +sevenBro.sevenBro[i].x() +" "+ sevenBro.sevenBro[i].y() + "\n");
    > ...
    >line = br.readLine();
    + 分别是读、写的时候。
+ 异常处理
    + JAVA的异常处理十分强大，在这个项目中我也用到了很多，如读取图片时、I/O操作时以及各种各样的时候，都用到了异常处理，这让我能够快速定位到出错的位置，方便修改。
+ JAVA特性
    + 封装
        + 所有东西都变成一个对象，对于对象的操作通过调用其方法实现，而不是直接修改。
    + 继承
        + 葫芦娃、蛇精、蝎子精等生物，都继承了Creature类。
    + 多态
        + 由于生物与Creature之间的继承关系，用具体生物体的地方都可以用父类代替。砖块上可以站各种生物体，既可以是葫芦娃，也可以是妖怪，体现了多态。

## 感想
    这是一个比较完整的工程，里面用到了各种Java机制。在写代码与Debug的时候，对于这些东西有了更加深刻的了解。而且由于项目比较大，需要明确设计好结构，才能使得写代码的时候事半功倍。写完之后，对于面向对象的理解也更进一步，万物皆可抽象成对象。这个理念，虽然也存在些许问题，比如《名词王国中的处刑》中提到的会带来赘余等问题，但总体来说，真的已经是足够强大了，可以让编程思路、结构更加清晰，是值得学习的。